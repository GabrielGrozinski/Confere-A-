    function ChanceQuitarDivida_15_anos(
        torcedores: number,
        faturamento: number,
        divida: number,
        lucro: number,
        anos: number,
        estimativa: number
    ) {
        if (divida <= 0) return 100;
        if (anos <= 0) return 0;

        let G0 =
            estimativa *
            (0.03 * Math.log(torcedores + 1) + 0.00018 * faturamento);

        G0 = Math.min(Math.max(G0, 0.04), 0.14);

        const rigidez = Math.min(Math.max(divida / faturamento, 0.5), 3);

        let lucroTotal = 0;
        let lucroAno = lucro;
        let G = G0;

        for (let i = 1; i <= anos; i++) {

            const capacidade = faturamento / divida;
            const margemLucro = lucroAno / faturamento;

            let anoRuim = false;

            // üü° clube fr√°gil
            if (lucroAno > 0 && margemLucro < 0.05 && capacidade <= 1.5) {
                const volatilidade =
                    0.15 + (1.5 - capacidade) * 0.2;

                lucroAno *= 1 + (Math.random() * 2 - 1) * volatilidade;
            }

            // üî¥ clube estruturalmente quebrado
            if (divida / faturamento >= 2.2) {
                let probAnoRuim =
                    0.45 +
                    (divida / faturamento - 2.2) * 0.2 +
                    (1 - estimativa) * 0.35;

                probAnoRuim = Math.min(Math.max(probAnoRuim, 0.45), 0.9);

                if (Math.random() < probAnoRuim) {
                    anoRuim = true;

                    // for√ßa preju√≠zo
                    const choque =
                        0.3 + Math.random() * 0.4; // 30% a 70% do faturamento

                    lucroAno = -faturamento * choque;
                }
            }

            // üîÅ din√¢mica normal s√≥ se N√ÉO foi ano ruim estrutural
            if (!anoRuim) {
                if (lucroAno < 0) {
                    lucroAno *= 1 - G / rigidez;
                } else {
                    lucroAno *= 1 + G;
                }
            }

            lucroTotal += lucroAno;
            G *= 0.92;
        }

        let R: number;

        if (lucro < 0) {
            const capacidade = faturamento / divida;
            const pesoPrejuizo = Math.abs(lucro) / faturamento;

            const scoreEstrutural = Math.log(1 + capacidade);
            const penalizacao =
                1 - Math.min((pesoPrejuizo * rigidez) / 0.35, 1);

            R = scoreEstrutural * penalizacao;
        } else {
            R = (lucroTotal / divida) / rigidez;
        }

        const threshold = 0.9 * rigidez;
        const slope = 2 / rigidez;

        let Pbase = 1 / (1 + Math.exp(-slope * (R - threshold)));

        Pbase = (divida/faturamento) > 2.5 ? Pbase/4 : (divida/faturamento) > 2 ? Pbase/2 : (divida/faturamento) > 1 ? Pbase/1.2 : (divida/faturamento) > 0.8 ? Pbase/1.2 : (lucro*100/divida) < 10 ? Pbase/1.2 : Pbase;

        return Math.max(0.01, Number((Pbase * 100).toFixed(2)));
    }



    if (clubeEscolhido && media) {
        const scoreFaturamento = media?.faturamento;
        const scoreTorcida = media.mediaTorcedores;
        const scoreDivida = media.divida;
        const scoreFinal = Number(((scoreFaturamento / scoreTorcida) - (scoreDivida / scoreTorcida)).toFixed(1));

        const scoreClube = Number(((clubeEscolhido.faturamento / clubeEscolhido.numero_torcedores*2) - (clubeEscolhido.divida / clubeEscolhido.numero_torcedores)).toFixed(1));

        const pontosAdicionais =
            scoreFinal > 0 ?
                Number(((scoreClube - scoreFinal)).toFixed(1))
                :
                Number(((scoreClube + scoreFinal)).toFixed(1));

        const pontosFiltrados =
            (
            pontosAdicionais > 100 ?
                2
                :
            pontosAdicionais > 50 ?
                1
                :
            pontosAdicionais > 0 ?
                0.5
                :
            pontosAdicionais < 100 ?
                -2
                :
            pontosAdicionais < 50 ?
                -1
                :
            pontosAdicionais < 0 ?
                -0.5
                :
                0
            );

        const valorCompeticao =
            (
                clubeEscolhido.competicao === 'libertadores' ?
                    2
                    :
                    clubeEscolhido.competicao === 'pre-libertadores' ?
                        1.5
                        :
                        clubeEscolhido.competicao === 'sul-americana' ?
                            1.5
                            :
                            clubeEscolhido.competicao === 'brasileirao' ?
                                1
                                :
                                -3
            );

        let rankingAtual =
            Number (
                (
                (clubeEscolhido.faturamento / clubeEscolhido.divida*2)
                +
                (
                    clubeEscolhido.lucro > 0 ?
                        (clubeEscolhido.lucro*2 / clubeEscolhido.faturamento) * 15
                        :
                        (-clubeEscolhido.lucro / clubeEscolhido.faturamento) * 5
                )
                ).toFixed(1)
            );

        rankingAtual = Number((rankingAtual + pontosFiltrados).toFixed(1));

        if (rankingAtual > 10) {
            rankingAtual = 10 + valorCompeticao > 10 ? 10 : 10 + valorCompeticao;
        } else if (rankingAtual < 0) {
            rankingAtual = 0 + valorCompeticao > 0 ? valorCompeticao : 0;
        } else {
            rankingAtual = 
                (rankingAtual + valorCompeticao) > 10 ? 
                10 
                : 
                (rankingAtual + valorCompeticao) < 0 ?
                0
                :
                rankingAtual + valorCompeticao;  
        }

        rankingAtual = Number(rankingAtual.toFixed(1));

        setRanking(Number(rankingAtual.toFixed(1)));
    }

    

export function projetarFaturamento(
  crescimentoAno1: number,
  crescimentoAno2: number,
  notaClube: number,
  anos: number,
  faturamentoAtual: number
): Faturamento {

  if (anos < 1 || anos > 15) {
    throw new Error("O n√∫mero de anos deve estar entre 1 e 15.");
  }

  const g1 = crescimentoAno1 / 100;
  const g2 = crescimentoAno2 / 100;

  // 1Ô∏è‚É£ Base mais punitiva
  const G_base = (0.3 * g1 + 0.7 * g2) * 0.6;

  // 2Ô∏è‚É£ Tend√™ncia amplificada
  let T = 1 + 1.5 * (g2 - g1);
  T = Math.max(0.75, Math.min(1.25, T));

  let G_calculado = G_base * T;

  // 3Ô∏è‚É£ üî• Multiplicador final pela nota
  G_calculado = G_calculado * (notaClube / 10);

  // 4Ô∏è‚É£ Limite anual entre 1% e 20%
  const G_final = Math.max(0.01, Math.min(0.20, G_calculado));

  // 5Ô∏è‚É£ Crescimento linear acumulado
  const crescimentoTotal = G_final * anos;

  const faturamentoNovo =
    faturamentoAtual * (1 + crescimentoTotal);

  return {
    crescimentoPercentual: Number((crescimentoTotal * 100).toFixed(2)),
    faturamentoProjetado: Number((faturamentoNovo).toFixed(2))
  };
}